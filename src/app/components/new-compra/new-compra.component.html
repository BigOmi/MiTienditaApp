<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Nueva Compra</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="compraForm" (ngSubmit)="crearCompraCompleta()">

    <!-- Datos de la Compra -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Datos de la Compra</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Número de Factura *</ion-label>
          <ion-input formControlName="numero_factura" type="text" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Proveedor *</ion-label>
          <ion-select formControlName="proveedor_id" placeholder="Selecciona un proveedor" required>
            <ion-select-option *ngFor="let prov of proveedores" [value]="prov.id">
              {{ prov.nombre }} {{ prov.apellido }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Estado *</ion-label>
          <ion-select formControlName="estado" required>
            <ion-select-option value="pendiente">Pendiente</ion-select-option>
            <ion-select-option value="completada">Completada</ion-select-option>
            <ion-select-option value="cancelada">Cancelada</ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Observaciones</ion-label>
          <ion-textarea formControlName="observaciones"></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Total</ion-label>
          <ion-input [value]="total" type="number" readonly></ion-input>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <!-- Datos del Producto -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Datos del Producto</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Nombre *</ion-label>
          <ion-input formControlName="nombre" type="text" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Descripción</ion-label>
          <ion-textarea formControlName="descripcion"></ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Imagen (URL)</ion-label>
          <ion-input formControlName="imagen" type="url"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Precio Compra *</ion-label>
          <ion-input formControlName="precio_compra" type="number" min="0.01" step="0.01" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Precio Venta *</ion-label>
          <ion-input formControlName="precio_venta" type="number" min="0.01" step="0.01" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Cantidad a Comprar (stock inicial) *</ion-label>
          <ion-input formControlName="stock_actual" type="number" min="1" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Categoría *</ion-label>
          <ion-select formControlName="categoriaId" placeholder="Selecciona una categoría" required>
            <ion-select-option *ngFor="let cat of categorias" [value]="cat.id">
              {{ cat.nombre }}
            </ion-select-option>
          </ion-select>
        </ion-item>
      </ion-card-content>
    </ion-card>

    <ion-button expand="block" color="success" type="submit" [disabled]="loading || compraForm.invalid">
      {{ loading ? 'Guardando...' : 'Crear Compra Completa' }}
    </ion-button>

  </form>
</ion-content>
